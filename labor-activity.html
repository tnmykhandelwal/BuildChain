<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Labor Activity & Analytics | BuildChain</title>
    <link rel="icon" type="image/png" href="logo.jpg">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div class="dashboard-container" style="flex-direction: row;">
        
        <main class="main-content" style="flex: 1; margin-right: 0;">
            <header class="content-header">
                <h1>üë∑ Labor Activity & Analytics</h1>
                <p>Comprehensive workforce monitoring and detailed labor analytics</p>
            </header>

            <!-- Project Selection -->
            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                <label><strong>Select a Project to View Labor Data:</strong></label>
                <select id="laborProjectSelect" style="width: 100%; padding: 12px; margin-top: 10px; border: 2px solid #3498db; border-radius: 4px; font-size: 1rem;">
                    <option value="">-- Loading Projects --</option>
                </select>
            </div>

            <!-- Key Metrics Cards -->
            <section id="metricsSection" style="display: none; margin-bottom: 30px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div class="metric-card">
                        <div style="font-size: 2.5rem; color: #27ae60; margin-bottom: 10px;">üë∑</div>
                        <h3 style="margin: 0; font-size: 1.5rem; color: #2c3e50;" id="totalWorkers">0</h3>
                        <p style="margin: 5px 0 0 0; color: #7f8c8d; font-size: 0.9rem;">Total Workforce</p>
                    </div>
                    <div class="metric-card">
                        <div style="font-size: 2.5rem; color: #3498db; margin-bottom: 10px;">üìä</div>
                        <h3 style="margin: 0; font-size: 1.5rem; color: #2c3e50;" id="totalManDays">0</h3>
                        <p style="margin: 5px 0 0 0; color: #7f8c8d; font-size: 0.9rem;">Total Man-Days</p>
                    </div>
                    <div class="metric-card">
                        <div style="font-size: 2.5rem; color: #e67e22; margin-bottom: 10px;">üìà</div>
                        <h3 style="margin: 0; font-size: 1.5rem; color: #2c3e50;" id="avgAttendance">0%</h3>
                        <p style="margin: 5px 0 0 0; color: #7f8c8d; font-size: 0.9rem;">Avg Attendance Rate</p>
                    </div>
                    <div class="metric-card">
                        <div style="font-size: 2.5rem; color: #9b59b6; margin-bottom: 10px;">‚öôÔ∏è</div>
                        <h3 style="margin: 0; font-size: 1.5rem; color: #2c3e50;" id="commonRole">-</h3>
                        <p style="margin: 5px 0 0 0; color: #7f8c8d; font-size: 0.9rem;">Most Common Role</p>
                    </div>
                </div>
            </section>

            <!-- Charts Grid -->
            <div id="chartsSection" style="display: none;">
                <!-- 7-Day Activity Chart -->
                <div style="background: white; padding: 25px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                    <h2 style="margin-top: 0; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">üìâ 7-Day Work Intensity Trend</h2>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 20px;">Number of active workers on-site for the past week</p>
                    <div style="height: 350px; width: 100%; position: relative;">
                        <canvas id="workIntensityChart"></canvas>
                    </div>
                </div>

                <!-- Worker Distribution by Role -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                        <h2 style="margin-top: 0; color: #2c3e50; border-bottom: 2px solid #27ae60; padding-bottom: 10px;">üéØ Workers by Role</h2>
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 20px;">Distribution of workforce across different roles</p>
                        <div style="height: 300px; position: relative;">
                            <canvas id="roleDistributionChart"></canvas>
                        </div>
                    </div>

                    <!-- Attendance Pattern -->
                    <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                        <h2 style="margin-top: 0; color: #2c3e50; border-bottom: 2px solid #e67e22; padding-bottom: 10px;">üìÖ Daily Attendance Pattern</h2>
                        <p style="font-size: 0.9rem; color: #666; margin-bottom: 20px;">Workers present on each day of the week</p>
                        <div style="height: 300px; position: relative;">
                            <canvas id="attendancePatternChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Worker Status Distribution -->
                <div style="background: white; padding: 25px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                    <h2 style="margin-top: 0; color: #2c3e50; border-bottom: 2px solid #9b59b6; padding-bottom: 10px;">‚ö° Worker Status Distribution</h2>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 20px;">Current status of workers on the project</p>
                    <div style="height: 300px; position: relative;">
                        <canvas id="statusDistributionChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Detailed Labor Table -->
            <section id="laborTableSection" style="display: none; margin-bottom: 30px;">
                <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                    <h2 style="margin-top: 0; color: #2c3e50; border-bottom: 2px solid #16a085; padding-bottom: 10px;">üë• Complete Labor Workforce</h2>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <input type="text" id="laborSearch" placeholder="Search workers by name or role..." 
                               style="flex: 1; min-width: 200px; padding: 10px; border: 1px solid #bdc3c7; border-radius: 4px;">
                        <select id="roleFilter" style="padding: 10px; border: 1px solid #bdc3c7; border-radius: 4px;">
                            <option value="">All Roles</option>
                        </select>
                    </div>

                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; background: white;">
                            <thead style="background: linear-gradient(135deg, #0b1c2c 0%, #2c5282 100%); color: white; position: sticky; top: 0;">
                                <tr>
                                    <th style="padding: 15px; text-align: left; border: 1px solid #ecf0f1;">Worker ID</th>
                                    <th style="padding: 15px; text-align: left; border: 1px solid #ecf0f1;">Full Name</th>
                                    <th style="padding: 15px; text-align: left; border: 1px solid #ecf0f1;">Role</th>
                                    <th style="padding: 15px; text-align: center; border: 1px solid #ecf0f1;">Days Present</th>
                                    <th style="padding: 15px; text-align: center; border: 1px solid #ecf0f1;">Attendance %</th>
                                    <th style="padding: 15px; text-align: center; border: 1px solid #ecf0f1;">Status</th>
                                    <th style="padding: 15px; text-align: center; border: 1px solid #ecf0f1;">Contact</th>
                                </tr>
                            </thead>
                            <tbody id="laborTableBody">
                                <tr>
                                    <td colspan="7" style="padding: 20px; text-align: center; color: #7f8c8d;">Loading worker data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Worker Details Cards -->
            <section id="workerCardsSection" style="display: none; margin-bottom: 30px;">
                <h2 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #16a085; padding-bottom: 10px;">üìã Individual Worker Profiles</h2>
                <div id="workerCardsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px;"></div>
            </section>

            <!-- Performance Insights -->
            <section id="insightsSection" style="display: none; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 30px;">
                <h2 style="margin-top: 0; color: #2c3e50; border-bottom: 2px solid #f39c12; padding-bottom: 10px;">üí° Labor Performance Insights</h2>
                <div id="insightsContent" style="margin-top: 20px;">
                    <p style="color: #7f8c8d;">Select a project to view performance insights.</p>
                </div>
            </section>

        </main>

        <!-- Sidebar Navigation -->
        <div class="sidebar right-sidebar" id="rightSidebar"> 
            <button id="toggleSidebarBtn" style="background: none; border: none; color: white; cursor: pointer; font-size: 1.2rem; align-self: flex-start; margin-bottom: 20px;">
                ‚ò∞
            </button>

            <div class="profile-info" style="text-align: center; margin-bottom: 30px;">
                <div style="width: 60px; height: 60px; background: #27ae60; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white;">
                    üë§
                </div>
                <h3 id="sidebarName" style="margin: 0; font-size: 1rem;">Guest</h3>
                <small style="color: #bdc3c7; background: rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 10px;">ANALYTICS VIEW</small>
            </div>

            <nav class="sidebar-nav">
                <button id="navMetrics" class="nav-item active" style="font-size: 0.9rem;">üìä Key Metrics</button>
                <button id="navCharts" class="nav-item" style="font-size: 0.9rem;">üìà Charts</button>
                <button id="navTable" class="nav-item" style="font-size: 0.9rem;">üë• Worker List</button>
                <button id="navProfiles" class="nav-item" style="font-size: 0.9rem;">üìã Profiles</button>
                <button id="navInsights" class="nav-item" style="font-size: 0.9rem;">üí° Insights</button>
            </nav>

            <button id="backBtn" class="logout-btn" style="margin-top: auto;">‚Üê Back</button>
        </div>

    </div>

    <style>
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 4px solid #3498db;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
    </style>
    <script src="env.js"></script>
    <script type="module" src="labor-activity.js"></script>
</body>
</html>
